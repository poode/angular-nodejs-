import { toString } from '@telerik/kendo-intl';
import { serializeDates } from './utils';
const WEEK_DAYS = {
    0: 'SU',
    1: 'MO',
    2: 'TU',
    3: 'WE',
    4: 'TH',
    5: 'FR',
    6: 'SA'
};
const serializeWeekDayList = (list) => {
    var idx = 0, length = list.length, value, valueString, result = [];
    for (; idx < length; idx++) {
        value = list[idx];
        if (typeof value === 'string') {
            valueString = value;
        }
        else {
            valueString = '' + WEEK_DAYS[value.day];
            if (value.offset) {
                valueString = value.offset + valueString;
            }
        }
        result.push(valueString);
    }
    return result.toString();
};
/**
 * @hidden
 *
 * Internal method for serializing a RecurrenceRule instance to string.
 */
export const serializeRule = (rrule, timezone) => {
    if (!rrule || !rrule.freq) {
        return null;
    }
    let weekStart = rrule.weekStart;
    let rruleString = 'FREQ=' + rrule.freq.toUpperCase();
    let exdates = '';
    let start = '';
    let end = '';
    let until = rrule.until;
    if (rrule.interval > 1) {
        rruleString += ';INTERVAL=' + rrule.interval;
    }
    if (rrule.count) {
        rruleString += ';COUNT=' + rrule.count;
    }
    if (until) {
        rruleString += ';UNTIL=' + toString(until.toTimezone('Etc/UTC'), 'yyyyMMddTHHmmss') + 'Z';
    }
    if (rrule.months) {
        rruleString += ';BYMONTH=' + rrule.months;
    }
    if (rrule.weeks) {
        rruleString += ';BYWEEKNO=' + rrule.weeks;
    }
    if (rrule.yearDays) {
        rruleString += ';BYYEARDAY=' + rrule.yearDays;
    }
    if (rrule.monthDays) {
        rruleString += ';BYMONTHDAY=' + rrule.monthDays;
    }
    if (rrule.weekDays) {
        rruleString += ';BYDAY=' + serializeWeekDayList(rrule.weekDays);
    }
    if (rrule.hours) {
        rruleString += ';BYHOUR=' + rrule.hours;
    }
    if (rrule.minutes) {
        rruleString += ';BYMINUTE=' + rrule.minutes;
    }
    if (rrule.seconds) {
        rruleString += ';BYSECOND=' + rrule.seconds;
    }
    if (rrule.positions) {
        rruleString += ';BYSETPOS=' + rrule.positions;
    }
    if (weekStart !== undefined) {
        rruleString += ';WKST=' + WEEK_DAYS[weekStart];
    }
    if (rrule.start) {
        start = 'DTSTART' + serializeDates([rrule.start]);
    }
    if (rrule.end) {
        end = 'DTEND' + serializeDates([rrule.end]);
    }
    if (rrule.exceptionDates) {
        exdates = 'EXDATE' + serializeDates(rrule.exceptionDates);
    }
    if (start || end || exdates) {
        rruleString = start + end + exdates + 'RRULE:' + rruleString;
    }
    return rruleString;
};
